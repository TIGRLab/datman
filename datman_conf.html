<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration Files &mdash; Datman 0.1.dev1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Library API (application program interface)" href="api.html" />
    <link rel="prev" title="Contributing to Datman" href="contributing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Datman
          </a>
              <div class="version">
                0.1.dev1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#docker-container">Docker Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Datman</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overriding-settings">Overriding Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#glossary">Glossary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exportinfo">ExportInfo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#required">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exportsettings">ExportSettings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ftp">FTP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#idmap">IdMap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logs">Logs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#paths">Paths</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pattern">Pattern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#projects">Projects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id17">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redcap">REDCap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id18">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sites">Sites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id21">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#study-metadata">Study Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id23">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#systemsettings">SystemSettings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xnat">XNAT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Library API (application program interface)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">What’s new?</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Datman</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Configuration Files</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/datman_conf.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration-files">
<span id="datman-conf"></span><h1>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline"></a></h1>
<p>Datman requires a main configuration file to run. This can be constructed from
the template file <code class="docutils literal notranslate"><span class="pre">main_config.yml</span></code> found in Datman’s
<code class="docutils literal notranslate"><span class="pre">assets/config_templates/</span></code> folder. Datman also requires a study config file
for each study it manages. You can use <code class="docutils literal notranslate"><span class="pre">study_config.yml</span></code>, found in the same
folder, to construct these.</p>
<p>Points to keep in mind when configuring Datman:</p>
<ol class="arabic simple">
<li><p>The configuration files are all <a class="reference external" href="https://en.wikipedia.org/wiki/YAML">yaml format</a></p></li>
<li><p>Keys are case-sensitive</p></li>
<li><p>Keys are expected to be CamelCase</p></li>
<li><p>Every setting (except SystemSettings) can be overridden by a study or
a scan site within a study. See <a class="reference internal" href="#overriding-settings">Overriding settings</a> for more info.</p></li>
</ol>
<section id="overriding-settings">
<h2>Overriding Settings<a class="headerlink" href="#overriding-settings" title="Permalink to this headline"></a></h2>
<p>Defining a setting in a ‘more specific’ context will override any setting
defined in a less specific block.</p>
<p>From <strong>most</strong> specific definition to <strong>least</strong> it goes:</p>
<ol class="arabic simple">
<li><p>Defining a setting within a ‘Sites’ block in a study config file (site level)</p></li>
<li><p>Defining a setting inside a study config file but outside of all ‘Sites’
blocks (study level).</p></li>
<li><p>Defining a setting within the main config file (global)</p></li>
</ol>
<p>As an example, assume you have a main config file with the following
xnat configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">XnatServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xnat.com</span><span class="w"></span>
<span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyProject</span><span class="w"></span>
</pre></div>
</div>
<p>And you have StudyA with the following xnat configuration in its study
configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StudyA</span><span class="w"></span>
</pre></div>
</div>
<p>When you run xnat scripts (like dm_xnat_extract.py) on StudyA the scripts will
find ‘xnat.com’ for XnatServer and will use ‘StudyA’ for the XnatArchive
(instead of ‘MyProject’ from the main config file).</p>
<p>Assume you have another study, StudyB, with the following in its study
configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StudyB</span><span class="w"></span>

<span class="nt">Sites</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">CMH</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StudyB_CMH</span><span class="w"></span>
<span class="w">   </span><span class="nt">YRK</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">XnatServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anotherxnat.com</span><span class="w"></span>
<span class="w">   </span><span class="nt">UTO</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="c1"># This site exists for the example, but doesnt define any xnat settings</span><span class="w"></span>
</pre></div>
</div>
<p>Running xnat scripts on StudyB will mean that the XNAT settings will
change depending on what site tag a scan has. The table below details
what settings are used for each of the three defined sites in StudyB.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 44%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Site Tag</p></th>
<th class="head"><p>XnatServer</p></th>
<th class="head"><p>XnatArchive</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CMH</p></td>
<td><p>xnat.com (main config)</p></td>
<td><p>StudyB_CMH (site config)</p></td>
</tr>
<tr class="row-odd"><td><p>YRK</p></td>
<td><p>anotherxnat.com (site config)</p></td>
<td><p>StudyB (study config)</p></td>
</tr>
<tr class="row-even"><td><p>UTO</p></td>
<td><p>xnat.com (main config)</p></td>
<td><p>StudyB (study config)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline"></a></h2>
<section id="exportinfo">
<h3>ExportInfo<a class="headerlink" href="#exportinfo" title="Permalink to this headline"></a></h3>
<p>This setting belongs in the site settings within a study config file. It
describes which data to export from XNAT and what tags to assign the exported
series. Note that each tag defined here must also exist within ExportSettings
in the main configuration file.</p>
<section id="required">
<h4>Required<a class="headerlink" href="#required" title="Permalink to this headline"></a></h4>
<p>These settings must exist for each tag that is defined.</p>
<ul class="simple">
<li><p><strong>Pattern</strong>: Describes fields from the dicom headers that must be matched for
the current tag to be assigned. See the <a class="reference internal" href="#pattern">Pattern</a> section for more info.</p></li>
<li><p><strong>Count</strong>: Indicates the number of series that should match this tag for
each session. Note that if more series are found than expected they will
still be tagged and downloaded correctly, this number is just used to
report that more were found than expected (or fewer) during QC.</p></li>
</ul>
</section>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ExportInfo</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Example tags. These can be named anything, but should be defined in</span><span class="w"></span>
<span class="w">  </span><span class="c1"># ExportSettings in the main config file first.</span><span class="w"></span>
<span class="w">  </span><span class="nt">T1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">T2</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">RST</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="exportsettings">
<h3>ExportSettings<a class="headerlink" href="#exportsettings" title="Permalink to this headline"></a></h3>
<p>This block defines the expected scan tags. Each tag has its own dictionary of
config values that defines which formats to convert to, which QC function to
use for human data, which QC function to use for phantoms, and
any bids export settings (if converting to bids format).</p>
<p><strong>NOTE:</strong> Any settings from this block can be overridden by the <a class="reference internal" href="#exportinfo">ExportInfo</a>
block in a study config file.</p>
<section id="id1">
<h4>Required<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<p>The following settings should be defined in the main configuration file and act
as defaults for each tag that studies will use. The benefit of pre-defining tags
this way is that it helps detect typos in a study config file, and helps prevent
different studies from tagging the same type of acquisition in different ways.</p>
<ul class="simple">
<li><p><strong>Formats</strong></p>
<ul>
<li><p>Description: This should be a list of formats that any series
matching the tag should be exported to.</p></li>
<li><p>Accepted values: a list which may contain any of these data formats ‘nii’,
‘dcm’, ‘mnc’, ‘nrrd’</p></li>
</ul>
</li>
<li><p><strong>QcType</strong></p>
<ul>
<li><p>Description: This defines what type of QC metrics dm_qc_report.py should
try to generate for human data that matches the tag.</p></li>
<li><p>Accepted values: ‘anat’, ‘fmri’, ‘dti’, ‘ignore’</p></li>
</ul>
</li>
</ul>
</section>
<section id="optional">
<h4>Optional<a class="headerlink" href="#optional" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>QcPha</strong></p>
<ul>
<li><p>Description: This defines what type of QC metrics dm_qc_report.py should
try to generate for phantom data that matches the tag.</p></li>
<li><p>Accepted values: ‘qa_dti’, ‘abcd_fmri’, or ‘default’.</p></li>
<li><p>Default value: If omitted, it will be treated as being set to ‘default’</p></li>
</ul>
</li>
<li><p>Any settings usually provided in <a class="reference internal" href="#exportinfo">ExportInfo</a> can also be set here to
provide a global default for a tag.</p></li>
</ul>
</section>
<section id="id2">
<h4>Example<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<p>The following is a small excerpt from our own ExportSettings</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ExportSettings</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">T1</span><span class="p">:</span><span class="w">         </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;mnc&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">anat</span><span class="p p-Indicator">,</span><span class="nt"> QcPha</span><span class="p">:</span><span class="w"> </span><span class="nv">default</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">T2</span><span class="p">:</span><span class="w">         </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">anat</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">RST</span><span class="p">:</span><span class="w">        </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">fmri</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">SPRL</span><span class="p">:</span><span class="w">       </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">fmri</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">DTI60-1000</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;nrrd&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">dti</span><span class="p p-Indicator">,</span><span class="nt"> QcPha</span><span class="p">:</span><span class="w"> </span><span class="nv">qa_dti</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">FMAP</span><span class="p">:</span><span class="w">       </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">ignore</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">  </span><span class="nt">DTI-ABCD</span><span class="p">:</span><span class="w">   </span><span class="p p-Indicator">{</span><span class="nt"> Formats</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;nii&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;dcm&#39;</span><span class="p p-Indicator">],</span><span class="nt"> QcType</span><span class="p">:</span><span class="w"> </span><span class="nv">dti</span><span class="p p-Indicator">,</span><span class="nt"> Pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ABCD_dMRI$&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
</pre></div>
</div>
<p>In this example all of the tags except DTI60-1000 will use the default phantom
QC for their respective QcType. The last tag (DTI-ABCD) provides an example
of using one of the optional settings to set up a default series
description pattern for study. Any study with the same tag in
their ExportInfo can override this by including their own ‘Pattern’ setting.</p>
</section>
</section>
<section id="ftp">
<h3>FTP<a class="headerlink" href="#ftp" title="Permalink to this headline"></a></h3>
<p>These settings manage SFTP access and are needed by scripts, like dm_sftp.py,
that interact with sftp servers.</p>
<section id="id3">
<h4>Required<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>FtpServer</strong>:</p>
<ul>
<li><p>Description: The fully qualified domain name, or IP address, of an SFTP
server that new MRI scans will be pulled from.</p></li>
</ul>
</li>
<li><p><strong>MrFolder</strong></p>
<ul>
<li><p>Description: A folder name, list of folder names, or python regex(s) to
help locate the folder containing scan zip files on the SFTP server.</p></li>
<li><p>Accepted values: A string (may be a literal string or a regex) or a list
of strings.</p></li>
</ul>
</li>
<li><p><strong>MrUser</strong></p>
<ul>
<li><p>Description: The username to log in to the SFTP server with.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id4">
<h4>Optional<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>FtpPort</strong></p>
<ul>
<li><p>Description: The port on the server to connect to. If omitted, port 22 is used.</p></li>
<li><p>Default: 22</p></li>
<li><p>Accepted values: an integer</p></li>
</ul>
</li>
<li><p><strong>MrFtpPass</strong></p>
<ul>
<li><p>Description: The name of the file in the study metadata folder to
get the SFTP password from. If omitted, a file named ‘mrftppass.txt’ is
searched for.</p></li>
<li><p>Default: ‘mrftppass.txt’</p></li>
</ul>
</li>
</ul>
</section>
<section id="id5">
<h4>Example<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FtpServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysftp.ca</span><span class="w"></span>
<span class="nt">FtpPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">777</span><span class="w"></span>
<span class="nt">MrFtpPass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myftppass.txt</span><span class="w">   </span><span class="c1"># Should exist in $STUDY/metadata/</span><span class="w"></span>
<span class="nt">MrUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myuser</span><span class="w"></span>
<span class="nt">MrFolder</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;somefolder&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;scans*&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;myscans[1-9]&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
</pre></div>
</div>
<p>In the above example the MrFolder setting will cause any folders on the
‘mysftp.ca’ server that are literally named “somefolder”, that start with
“scans” or that start with “myscans” followed by a number between 1 and 9 to
be searched for scan zip files.</p>
</section>
</section>
<section id="idmap">
<h3>IdMap<a class="headerlink" href="#idmap" title="Permalink to this headline"></a></h3>
<p>Provides a method of translating between ID schemes (Datman to KCNI or vice
versa).</p>
<section id="id6">
<h4>Optional<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>Study</strong>:</p>
<ul>
<li><p>Description: Maps the expected value for the KCNI study ID field to the
expected value for the Datman study ID field.</p></li>
</ul>
</li>
<li><p><strong>Site</strong>:</p>
<ul>
<li><p>Description: Maps the expected value for the KCNI site ID field to the
expected value for the Datman site ID field.</p></li>
</ul>
</li>
<li><p><strong>Subject</strong>:</p>
<ul>
<li><p>Description: Describes how to convert the subject ID field from KCNI
convention to Datman convention and back again. This is more complicated.
It requires two pairs of
<a class="reference external" href="https://docs.python.org/3/howto/regex.html">python style regexes</a>. The
first pair matches the portion of the KCNI subject ID that must be
preserved for the Datman subject ID field and shows how to mangle this
portion into Datman format. The second pair reverses this: it provides the
regex that shows what part of the Datman subject field to preserve and a
regex to mangle this portion into a KCNI subject ID field. Each pair of
regexes is separated by ‘-&gt;’ to indicate where one regex ends and the next
begins. See the ‘Example’ section for specific examples.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id7">
<h4>Example<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">IdMap</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Any of the below sections can be omitted if the field doesn&#39;t change</span><span class="w"></span>
<span class="w">  </span><span class="c1"># between naming conventions.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Left side (keys) are KCNI convention, right side (values) are Datman convention.</span><span class="w"></span>
<span class="w">  </span><span class="c1">#</span><span class="w"></span>
<span class="w">  </span><span class="c1"># KCNI ID                               Datman ID</span><span class="w"></span>
<span class="w">  </span><span class="c1"># STU01_UTO_10001_01_SE01_MR  becomes   STUDY1_UT2_ABC0001_01_01</span><span class="w"></span>
<span class="w">  </span><span class="nt">Study</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">STU01</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STUDY1</span><span class="w"></span>
<span class="w">  </span><span class="nt">Site</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">UTO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UT2</span><span class="w"></span>
<span class="w">  </span><span class="nt">Subject</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;1(P?[0-9]+)-&gt;ABC\1&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;ABC(P?[0-9]+)-&gt;1\1&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Permalink to this headline"></a></h3>
<p>These settings manage log configuration for datman’s log server
(dm_log_server.py) and for scripts that are able to log to it.</p>
<section id="id8">
<h4>Required<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>LogServer</strong></p>
<ul>
<li><p>Description: The domain name or IP address of the machine that the log
server (dm_log_server.py) will be listening on. This is also read by scripts
that output log messages to find the log server.</p></li>
</ul>
</li>
<li><p><strong>ServerLogDir</strong></p>
<ul>
<li><p>Description: The full path to the directory where dm_log_server.py should
store all logs. This directory should be accessible to the machine running
the log server (i.e. a path local to that machine or an NFS directory
mounted to it). Only needed if LogServer is set.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id9">
<h4>Example<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">LogServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">111.222.333.444</span><span class="w"></span>
<span class="nt">LogServerDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/logs/datman_logs</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="paths">
<h3>Paths<a class="headerlink" href="#paths" title="Permalink to this headline"></a></h3>
<p>This block determines the structure for the contents of each Datman managed
study folder. The keys are a short descriptive name for the
folder and the values are the relative path the folder should be given within
configured studies.</p>
<section id="id10">
<h4>Required<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h4>
<p>Below is a list of paths that must be configured for Datman to function
correctly. Most of the core scripts read from or write to the directories
listed here.</p>
<ul class="simple">
<li><p><strong>meta</strong>: Points to the folder meant to hold metadata like scans.csv,
blacklist.csv, checklist.csv, etc.</p></li>
<li><p><strong>data</strong>: Parent folder for the original dicom data and its other raw formats
like nifti, mnc, etc.</p></li>
<li><p><strong>dcm</strong>: The folder that will hold raw dicom data. Only one dicom image per
series is stored here</p></li>
<li><p><strong>dicom</strong>: The folder that will hold raw zip files of dicoms before the
site naming convention is applied</p></li>
<li><p><strong>zips</strong>: The folder that holds the name-corrected links that point to the raw
zip files in the ‘dicom’</p></li>
<li><p><strong>resources</strong>: The folder that holds all non-dicom data that was present in
the raw zip files</p></li>
<li><p><strong>nii, mnc, nrrd</strong>: Folders that hold the converted data in nifti, mnc and
nrrd formats respectively. If a format will not be used by your site
(e.g. mnc) you can omit it.</p></li>
<li><p><strong>qc</strong>: Holds all the QC pipeline outputs</p></li>
<li><p><strong>logs</strong>: The folder that will store log output from various scripts and
nightly pipelines</p></li>
</ul>
</section>
<section id="id11">
<h4>Optional<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h4>
<p>These paths must be configured if the scripts listed are in use, but may be
omitted otherwise</p>
<ul class="simple">
<li><p><strong>std</strong></p>
<ul>
<li><p>Description: Points to the folder that will hold gold standards to be used
when comparing dicom header parameters. These gold standards should be
stored as json files containing the expected values for important DICOM
header fields.</p></li>
<li><p>Used by:</p>
<ul>
<li><p>dm_qc_report.py - Reads from this folder</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>task</strong></p>
<ul>
<li><p>Description: Points to the folder that holds the any fmri task files.</p></li>
<li><p>Used by:</p>
<ul>
<li><p>dm_task_files.py - Writes to this folder</p></li>
<li><p>dm_parse_ea.py - Reads from this folder</p></li>
<li><p>dm_parse_Nback.py - Reads from this folder</p></li>
<li><p>dm_parse_GNGo.py - Reads from this folder</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>bids</strong></p>
<ul>
<li><p>Description: Points to the folder that holds the raw data organized into
bids format.</p></li>
<li><p>Used by:</p>
<ul>
<li><p>bidsify.py - Writes to this folder</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id12">
<h4>Example<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h4>
<p>This example is a subset of all keys available.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Paths</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># The paths on the right can be modified as preferred</span><span class="w"></span>
<span class="w">   </span><span class="nt">meta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata/</span><span class="w"></span>
<span class="w">   </span><span class="nt">std</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">metadata/standards/</span><span class="w"></span>
<span class="w">   </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/</span><span class="w"></span>
<span class="w">   </span><span class="nt">dcm</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">data/dcm/</span><span class="w"></span>
<span class="w">   </span><span class="nt">nii</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">data/nii/</span><span class="w"></span>
<span class="w">   </span><span class="nt">nrrd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/nrrd/</span><span class="w"></span>
<span class="w">   </span><span class="nt">qc</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">qc/</span><span class="w"></span>
<span class="w">   </span><span class="nt">log</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">logs/</span><span class="w"></span>
</pre></div>
</div>
<p>Assuming a configuration where the <code class="docutils literal notranslate"><span class="pre">DatmanProjectsDir</span></code> is set to
<code class="docutils literal notranslate"><span class="pre">/archive/data</span></code> (as it is in ours) and a <code class="docutils literal notranslate"><span class="pre">ProjectDir</span></code> of <code class="docutils literal notranslate"><span class="pre">SPINS</span></code> the above
settings would generate a project with the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/archive/data/SPINS/
                   │
                   └─── metadata
                   │   │
                   │   └─── standards
                   │
                   └─── data
                   │   │
                   │   └─── dcm
                   │   │
                   │   └─── mnc
                   │   │
                   │   └─── nrrd
                   │
                   └─── qc
                   │
                   └─── logs
</pre></div>
</div>
</section>
</section>
<section id="pattern">
<h3>Pattern<a class="headerlink" href="#pattern" title="Permalink to this headline"></a></h3>
<p>This setting should be defined for each tag inside <a class="reference internal" href="#exportinfo">ExportInfo</a>. It describes
how to assign a tag to each series based on the dicom header fields.</p>
<section id="id13">
<h4>Required<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>SeriesDescription</strong>:</p>
<ul>
<li><p>Description: A python regex that will match the series description field
in the dicom headers for any series that should receive the current tag.</p></li>
<li><p>Accepted values: <a class="reference external" href="https://docs.python.org/3/howto/regex.html">A python regex</a>
or list of regexes.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id14">
<h4>Optional<a class="headerlink" href="#id14" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>ImageType</strong>:</p>
<ul>
<li><p>Description: A python regex to match the image type of the dicom header.
Used to distinguish between different image types when the series
description is identical.</p></li>
<li><p>Accepted values: <a class="reference external" href="https://docs.python.org/3/howto/regex.html">A python regex.</a></p></li>
</ul>
</li>
<li><p><strong>EchoNumber</strong>:</p>
<ul>
<li><p>Description: The echo number to apply the tag to when multiple exist within
a single acquisition.</p></li>
<li><p>Accepted values: an integer.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id16">
<h4>Example<a class="headerlink" href="#id16" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ExportInfo</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">T1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Sag.?T1.BRAVO&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">DTI60-1000</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># A list of regexes is also allowed</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;ep2d&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;DTI.60Dir*GRAPPA$&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">  </span><span class="c1"># These two entries give an example of using echo number to split multiple</span><span class="w"></span>
<span class="w">  </span><span class="c1"># echoes out of an acquisition.</span><span class="w"></span>
<span class="w">  </span><span class="nt">MAG1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;field&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">EchoNumber</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">MAG2</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;field&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">EchoNumber</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="c1"># These two entries give an example of using ImageType to apply different</span><span class="w"></span>
<span class="w">  </span><span class="c1"># tags to series with the same SeriesDescription</span><span class="w"></span>
<span class="w">  </span><span class="nt">T2</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;T2w_SPC_vNav$&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">ImageType</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ORIGINAL.*ND$&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">T2-NORM</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Pattern</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">SeriesDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;T2w_SPC_vNav$&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">ImageType</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ORIGINAL.*ND.*NORM$&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">Count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="projects">
<h3>Projects<a class="headerlink" href="#projects" title="Permalink to this headline"></a></h3>
<p>The projects block contains a list of short-hand codes for each study that
Datman is expected to manage. Each code <strong>must</strong> be unique and is
case-sensitive. Each defined project should map to the name of that study’s
config file. These files will be searched for in the ConfigDir (from the
<a class="reference internal" href="#systemsettings">SystemSettings</a>) for the current system.</p>
<section id="id17">
<h4>Example<a class="headerlink" href="#id17" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that &#39;Projects&#39; is CamelCase, but study codes may be whatever</span><span class="w"></span>
<span class="c1"># case you like. You must use that same capitalization when</span><span class="w"></span>
<span class="c1"># using any datman script on a project (e.g. dm_xnat_extract,py StUdYc)</span><span class="w"></span>
<span class="nt">Projects</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Study1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">study1_config.yml</span><span class="w"></span>
<span class="w">  </span><span class="nt">STUDYB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STUDYB.yml</span><span class="w"></span>
<span class="w">  </span><span class="nt">StUdYc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mystudy.yaml</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="redcap">
<h3>REDCap<a class="headerlink" href="#redcap" title="Permalink to this headline"></a></h3>
<p>Any settings needed to use REDCap integrations are described below. These
settings are used by scripts like <code class="docutils literal notranslate"><span class="pre">dm_redcap_scan_complete.py</span></code>,
<code class="docutils literal notranslate"><span class="pre">dm_link_shared_ids.py</span></code>.</p>
<section id="id18">
<h4>Required<a class="headerlink" href="#id18" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>RedcapApi</strong>:</p>
<ul>
<li><p>Description: The URL for the REDCap API endpoint.</p></li>
<li><p>Used by: dm_link_shared_ids.py</p></li>
</ul>
</li>
<li><p><strong>RedcapUrl</strong>:</p>
<ul>
<li><p>Description: The URL for the REDCap server to pull information from.</p></li>
<li><p>Used by: dm_redcap_scan_complete.py</p></li>
</ul>
</li>
<li><p><strong>RedcapProjectId</strong>:</p>
<ul>
<li><p>Description: The project ID to use when retrieving records.</p></li>
</ul>
</li>
<li><p><strong>RedcapInstrument</strong>:</p>
<ul>
<li><p>Description: The instrument to retrieve records from.</p></li>
<li><p>Accepted values: a string.</p></li>
</ul>
</li>
<li><p><strong>RedcapEventId</strong>:</p>
<ul>
<li><p>Description: A dictionary of event names mapped to their IDs.</p></li>
<li><p>Accepted values: A dictionary.</p></li>
</ul>
</li>
<li><p><strong>RedcapRecordKey</strong>:</p>
<ul>
<li><p>Description: The name of the survey field that contains the unique record
ID.</p></li>
<li><p>Accepted values: a string.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id19">
<h4>Optional<a class="headerlink" href="#id19" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>RedcapComments</strong>:</p>
<ul>
<li><p>Description: The name of the survey field that holds comments from the
RA who attended the scan.</p></li>
<li><p>Default: ‘cmts’</p></li>
</ul>
</li>
<li><p><strong>RedcapDate</strong>:</p>
<ul>
<li><p>Description: The name of the survey field that holds the date the survey
was completed.</p></li>
<li><p>Default: ‘date’</p></li>
</ul>
</li>
<li><p><strong>RedcapStatus</strong>:</p>
<ul>
<li><p>Description: The name of the survey field that will indicate whether the
form is complete.</p></li>
<li><p>Default: ‘tigrlab_scan_completed_complete’</p></li>
</ul>
</li>
<li><p><strong>RedcapStatusValue</strong>:</p>
<ul>
<li><p>Description: A value or list of values that RedcapStatus may take to
indicate that the form is complete.</p></li>
<li><p>Accepted values: a list of strings or a string.</p></li>
<li><p>Default: ‘2’</p></li>
</ul>
</li>
<li><p><strong>RedcapSubj</strong>:</p>
<ul>
<li><p>Description: The name of the survey field that holds the session ID</p></li>
<li><p>Default: ‘par_id’</p></li>
</ul>
</li>
<li><p><strong>RedcapToken</strong>:</p>
<ul>
<li><p>Description: The name of the file that will hold the token to access
REDCap’s API. The file should be stored in the study metadata folder and
be readable to the user(s) who will run any of datman’s redcap scripts.
If undefined, the environment variable REDCAP_TOKEN will be used instead.
Note that, unlike the RedcapToken setting, the REDCAP_TOKEN variable should
contain the token itself and not the name of a file to read a token from.</p></li>
</ul>
</li>
<li><p><strong>UsesRedcap</strong>:</p>
<ul>
<li><p>Description: Indicates whether to expect a redcap ‘scan completed’ survey
for sessions in a study (or site).</p></li>
<li><p>Default: False</p></li>
<li><p>Used by: QC Dashboard</p></li>
</ul>
</li>
</ul>
</section>
<section id="id20">
<h4>Example<a class="headerlink" href="#id20" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">UsesRedcap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">    </span><span class="c1"># if unset, is treated as False</span><span class="w"></span>
<span class="nt">RedcapApi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myredcapserver.com/api</span><span class="w"> </span><span class="c1"># These two can refer to different servers</span><span class="w"></span>
<span class="nt">RedcapUrl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myredcapserver.com</span><span class="w"></span>
<span class="nt">RedcapToken</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mytoken.txt&#39;</span><span class="w">  </span><span class="c1"># Should exist in $STUDY/metadata,</span><span class="w"></span>
<span class="w">                            </span><span class="c1"># if unset, REDCAP_TOKEN env var is read</span><span class="w"></span>
<span class="nt">RedcapProjectId</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1111&#39;</span><span class="w"></span>
<span class="nt">RedcapInstrument</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;my_instrument&#39;</span><span class="w"></span>
<span class="nt">RedcapEventId</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arm1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">111</span><span class="w">   </span><span class="c1"># Each entry should be event label mapped to its ID</span><span class="w"></span>
<span class="w">  </span><span class="nt">arm2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">112</span><span class="w"></span>
<span class="w">  </span><span class="nt">arm3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">999</span><span class="w"></span>
<span class="nt">RedcapSubj</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sub_id_field&#39;</span><span class="w">      </span><span class="c1"># If unset, &#39;par_id&#39; is used</span><span class="w"></span>
<span class="nt">RedcapDate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;date_field&#39;</span><span class="w">        </span><span class="c1"># If unset, &#39;date&#39; is used</span><span class="w"></span>
<span class="nt">RedcapStatus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;is_complete&#39;</span><span class="w">     </span><span class="c1"># If unset, &#39;tigrlab_scan_completed_complete&#39; is used</span><span class="w"></span>
<span class="nt">RedcapStatusValue</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;1&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;2&#39;</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># If unset, &#39;2&#39; is used</span><span class="w"></span>
<span class="nt">RedcapRecordKey</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;record_id_field&#39;</span><span class="w"></span>
<span class="nt">RedcapComments</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;comment_field&#39;</span><span class="w"> </span><span class="c1"># If unset, &#39;cmts&#39; is used</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="sites">
<h3>Sites<a class="headerlink" href="#sites" title="Permalink to this headline"></a></h3>
<p>Each scan site collecting data for a study needs its own configuration
block in the study config file. Any site-specific configuration should
be placed in this block to override study or global defaults.</p>
<section id="id21">
<h4>Required<a class="headerlink" href="#id21" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>ExportInfo</strong>:</p>
<ul>
<li><p>Description: A block of configuration describing which scans to download
and how to apply scan tags to them. See <a class="reference internal" href="#exportinfo">ExportInfo</a> for more info.</p></li>
</ul>
</li>
<li><p><strong>Site codes</strong>:</p>
<ul>
<li><p>Description: One unique code per scan site that will collect scans for the
study. Each site code will be matched to the site tag portion of a
<a class="reference external" href="https://github.com/TIGRLab/documentation/wiki/Data-Naming">Datman style ID.</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="id22">
<h4>Example<a class="headerlink" href="#id22" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Sites</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Your site codes may be whatever you like, but they should fit</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Datman&#39;s convention of being no more than three characters and</span><span class="w"></span>
<span class="w">    </span><span class="c1"># only containing letters and numbers.</span><span class="w"></span>
<span class="w">    </span><span class="nt">CMH</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Site specific settings can go here</span><span class="w"></span>
<span class="w">      </span><span class="nt">ExportInfo</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="nt">UT1</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># As an example, a site can upload to a different XNAT project</span><span class="w"></span>
<span class="w">      </span><span class="c1"># by redefining XnatArchive here</span><span class="w"></span>
<span class="w">      </span><span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSTUDY_UT1</span><span class="w"></span>
<span class="w">      </span><span class="nt">ExportInfo</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">    </span><span class="nt">XXX</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">ExportInfo</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="study-metadata">
<h3>Study Metadata<a class="headerlink" href="#study-metadata" title="Permalink to this headline"></a></h3>
<p>These settings should be included in each study’s config file.</p>
<section id="id23">
<h4>Required<a class="headerlink" href="#id23" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>ProjectDir</strong>:</p>
<ul>
<li><p>Description: The name of the folder that will hold all of the study’s
contents. This folder will be created inside the current system’s
DatmanProjectsDir if it does not already exist.</p></li>
</ul>
</li>
<li><p><strong>StudyTag</strong>:</p>
<ul>
<li><p>Description: The tag that will be used for the ‘study’ field in each
session’s <a class="reference external" href="http://imaging-genetics.camh.ca/documentation/#/data/introduction/Data-Naming">ID.</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="id24">
<h4>Optional<a class="headerlink" href="#id24" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>Description</strong>:</p>
<ul>
<li><p>Description: A freeform description of the study and the data it contains.</p></li>
</ul>
</li>
<li><p><strong>FullName</strong>:</p>
<ul>
<li><p>Description: The full name of the study.</p></li>
</ul>
</li>
<li><p><strong>IsOpen</strong>:</p>
<ul>
<li><p>Description: Whether the study is still collecting data.</p></li>
<li><p>Default: True</p></li>
<li><p>Accepted values: A python boolean.</p></li>
</ul>
</li>
<li><p><strong>PrimaryContact</strong>:</p>
<ul>
<li><p>Description: The name of the contact for the study.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id25">
<h4>Example<a class="headerlink" href="#id25" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ProjectDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testing</span><span class="w"></span>
<span class="nt">StudyTag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TEST</span><span class="w"></span>
<span class="nt">FullName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test datman installation</span><span class="w"></span>
<span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is a temporary study used to test against.</span><span class="w"></span>
<span class="nt">PrimaryContact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clevis Boxx</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="systemsettings">
<h3>SystemSettings<a class="headerlink" href="#systemsettings" title="Permalink to this headline"></a></h3>
<p>At least one system must be configured. This block can allow
multiple users to have their own separately managed Datman projects or allow
one installed copy of datman to manage projects stored in separate locations.</p>
<p>To run datman you must set the shell variable DM_SYSTEM to the name of one
of the systems defined here (DM_SYSTEM is case-sensitive).</p>
<section id="id26">
<h4>Required<a class="headerlink" href="#id26" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>ConfigDir</strong>: The full path to the folder where all configuration files are
stored. For example, on our system this is <cite>/archive/code/config/</cite></p></li>
<li><p><strong>DatmanAssetsDir</strong>: The full path to datman’s assets folder. For example, on our
local system this is <cite>/archive/code/datman/assets/</cite></p></li>
<li><p><strong>DatmanProjectsDir</strong>: Must be the full path to the folder where a set of datman
managed projects will be kept. For example, on our local system this is
<cite>/archive/data/</cite></p></li>
</ul>
</section>
<section id="id27">
<h4>Optional<a class="headerlink" href="#id27" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>Queue</strong>: This specifies the type of queue that jobs will be submitted to if a
queue is available. Currently this can be either ‘sge’ or ‘slurm’.</p></li>
</ul>
</section>
<section id="id28">
<h4>Example<a class="headerlink" href="#id28" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">SystemSettings</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># You can capitalize system names however you like but when setting</span><span class="w"></span>
<span class="w">   </span><span class="c1"># DM_SYSTEM you must match the case exactly (e.g. DM_SYSTEM=testing)</span><span class="w"></span>
<span class="w">   </span><span class="nt">MySystem</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">DatmanProjectsDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/archive/data</span><span class="w"></span>
<span class="w">       </span><span class="nt">DatmanAssetsDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/archive/code/datman/assets</span><span class="w"></span>
<span class="w">       </span><span class="nt">ConfigDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/archive/code/config</span><span class="w"></span>
<span class="w">       </span><span class="nt">Queue</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slurm</span><span class="w"></span>
<span class="w">   </span><span class="nt">testing</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="c1"># Note that &#39;testing&#39; is using the same copy of datman (i.e. datman</span><span class="w"></span>
<span class="w">       </span><span class="c1"># is only installed once) but the data + config files are located elsewhere</span><span class="w"></span>
<span class="w">       </span><span class="nt">DatmanProjectsDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/data/</span><span class="w"></span>
<span class="w">       </span><span class="nt">DatmanAssetsDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/archive/code/datman/assets</span><span class="w"></span>
<span class="w">       </span><span class="nt">ConfigDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/data/config</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="xnat">
<h3>XNAT<a class="headerlink" href="#xnat" title="Permalink to this headline"></a></h3>
<p>These settings are used by scripts that interact with XNAT, such as
dm_xnat_upload.py and dm_xnat_extract.py.</p>
<section id="id29">
<h4>Required<a class="headerlink" href="#id29" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>XnatArchive</strong></p>
<ul>
<li><p>Description: The name of a project on XNAT to read from / write to. Must
match the Project ID (not project title) on XNAT exactly.</p></li>
</ul>
</li>
<li><p><strong>XnatServer</strong></p>
<ul>
<li><p>Description: Contains the full URL or IP address of the XNAT server to use</p></li>
</ul>
</li>
</ul>
</section>
<section id="id30">
<h4>Optional<a class="headerlink" href="#id30" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><strong>XnatConvention</strong></p>
<ul>
<li><p>Description: The naming convention to use on the XNAT server. May differ
from the naming convention used in the archive (which is Datman). If
not specified, defaults to ‘DATMAN’.</p></li>
<li><p>Accepted values: ‘DATMAN’ or ‘KCNI’</p></li>
</ul>
</li>
<li><p><strong>XnatCredentials</strong></p>
<ul>
<li><p>Description: The name of a file in the study metadata folder that will
contain the username and password for the XNAT server. The file must
contain the username on the first line, and the password on the second line.
If this setting is provided, it will override the environment variables
<cite>XNAT_USER</cite> and <cite>XNAT_PASS</cite>.</p></li>
</ul>
</li>
<li><p><strong>XnatPort</strong></p>
<ul>
<li><p>Description: Specifies which port to connect to on the server. If not
specified, port 443 is used (the standard https port).</p></li>
<li><p>Accepted values: an integer.</p></li>
</ul>
</li>
<li><p><strong>XnatSource</strong></p>
<ul>
<li><p>Description: The domain name or IP address of the XNAT server to pull new
scan zip files from. Only used when a second XNAT server is treated as the
source for new scan data (instead of an SFTP server). If defined,
XnatSourceArchive and XnatSourceCredentials must also be defined.</p></li>
<li><p>Used by: xnat_fetch_sessions.py</p></li>
</ul>
</li>
<li><p><strong>XnatSourceArchive</strong></p>
<ul>
<li><p>Description: The Project ID on XnatSource to pull new scans from. Must be
defined if XnatSource is.</p></li>
<li><p>Used by: xnat_fetch_sessions.py</p></li>
</ul>
</li>
<li><p><strong>XnatSourceCredentials</strong></p>
<ul>
<li><p>Description: The name of the file in the study metadata folder that will
hold the username and password for the XnatSource server. The file must
contain the username on the first line and the password on the second line.
Must be defined if XnatSource is defined.</p></li>
<li><p>Used by: xnat_fetch_sessions.py</p></li>
</ul>
</li>
</ul>
</section>
<section id="id31">
<h4>Example<a class="headerlink" href="#id31" title="Permalink to this headline"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">XnatServer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myxnat.ca</span><span class="w"></span>
<span class="nt">XnatPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">777</span><span class="w"></span>
<span class="nt">XnatArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyProject</span><span class="w"></span>
<span class="nt">XnatConvention</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KCNI</span><span class="w"></span>
<span class="nt">XnatCredentials</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xnatlogin.txt</span><span class="w">   </span><span class="c1"># Should exist in the study metadata folder</span><span class="w"></span>

<span class="c1"># The below is only used because an XNAT server is being used as a data source</span><span class="w"></span>
<span class="nt">XnatSource</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otherxnat.ca</span><span class="w"></span>
<span class="nt">XnatSourceArchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RemoteProjectID</span><span class="w"></span>
<span class="nt">XnatSourceCredentials</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remotelogin.txt</span><span class="w">  </span><span class="c1"># Should exist in the study metadata folder</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="contributing.html" class="btn btn-neutral float-left" title="Contributing to Datman" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="Library API (application program interface)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, TIGRLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>